From c01d8b02f3fa912a320ddad07a03212822f267ec Mon Sep 17 00:00:00 2001
From: Cristy <mikayla-grace@urban-warrior.org>
Date: Sat, 23 Mar 2019 14:52:24 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/1517

---
 coders/dpx.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

--- a/coders/dpx.c
+++ b/coders/dpx.c
@@ -2035,13 +2035,16 @@ static MagickBooleanType WriteDPXImage(c
   pixels=GetQuantumPixels(quantum_info);
   for (y=0; y < (ssize_t) image->rows; y++)
   {
+    size_t
+      length;
+
     p=GetVirtualPixels(image,0,y,image->columns,1,&image->exception);
     if (p == (const PixelPacket *) NULL)
       break;
-    (void) ExportQuantumPixels(image,(const CacheView *) NULL,quantum_info,
+    length=ExportQuantumPixels(image,(const CacheView *) NULL,quantum_info,
       quantum_type,pixels,&image->exception);
     count=WriteBlob(image,extent,pixels);
-    if (count != (ssize_t) extent)
+    if (count != (ssize_t) length)
       break;
     status=SetImageProgress(image,SaveImageTag,(MagickOffsetType) y,
       image->rows);
@@ -2049,6 +2052,8 @@ static MagickBooleanType WriteDPXImage(c
       break;
   }
   quantum_info=DestroyQuantumInfo(quantum_info);
+  if (y < (ssize_t) image->rows)
+    ThrowWriterException(CorruptImageError,"UnableToWriteImageData");
   (void) CloseBlob(image);
   return(status);
 }

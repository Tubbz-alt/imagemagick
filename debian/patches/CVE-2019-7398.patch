From 20c360e14cd5d70b5bbd0b54afa241eae4aec45d Mon Sep 17 00:00:00 2001
From: Cristy <mikayla-grace@urban-warrior.org>
Date: Sun, 20 Jan 2019 10:50:08 -0500
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/1453

---
 coders/dib.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

Index: imagemagick-6.9.10.23+dfsg/coders/dib.c
===================================================================
--- imagemagick-6.9.10.23+dfsg.orig/coders/dib.c	2019-06-12 14:02:09.842836624 -0400
+++ imagemagick-6.9.10.23+dfsg/coders/dib.c	2019-06-12 14:04:13.178952743 -0400
@@ -1380,7 +1380,10 @@ static MagickBooleanType WriteDIBImage(c
           dib_colormap=(unsigned char *) AcquireQuantumMemory((size_t)
             (1UL << dib_info.bits_per_pixel),4*sizeof(*dib_colormap));
           if (dib_colormap == (unsigned char *) NULL)
-            ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
+            {
+              pixels=(unsigned char *) RelinquishMagickMemory(pixels);
+              ThrowWriterException(ResourceLimitError,"MemoryAllocationFailed");
+            }
           q=dib_colormap;
           for (i=0; i < (ssize_t) MagickMin(image->colors,dib_info.number_colors); i++)
           {

From ffedc1feed46ae5dfad2aeaf4bd9c42174ec0ad1 Mon Sep 17 00:00:00 2001
From: Cristy <mikayla-grace@urban-warrior.org>
Date: Sun, 20 Jan 2019 11:12:07 -0500
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/1450

---
 coders/pcd.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/coders/pcd.c b/coders/pcd.c
index ec28d91de..3f15f81df 100644
--- a/coders/pcd.c
+++ b/coders/pcd.c
@@ -205,6 +205,8 @@ static MagickBooleanType DecodeImage(Image *image,unsigned char *luma,
     if (pcd_table[i] == (PCDTable *) NULL)
       {
         buffer=(unsigned char *) RelinquishMagickMemory(buffer);
+        for (j=0; j < i; j++)
+          pcd_table[j]=(PCDTable *) RelinquishMagickMemory(pcd_table[j]);
         ThrowBinaryImageException(ResourceLimitError,"MemoryAllocationFailed",
           image->filename);
       }
@@ -216,6 +218,8 @@ static MagickBooleanType DecodeImage(Image *image,unsigned char *luma,
       if (r->length > 16)
         {
           buffer=(unsigned char *) RelinquishMagickMemory(buffer);
+          for (j=0; j <= i; j++)
+            pcd_table[j]=(PCDTable *) RelinquishMagickMemory(pcd_table[j]);
           return(MagickFalse);
         }
       PCDGetBits(16);
